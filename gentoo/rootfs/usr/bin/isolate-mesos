#!/bin/bash

#------------------------------------------------------------------------------
# Function: isolate <binary>
#------------------------------------------------------------------------------

function isolate {
  for i in $(ldd $1 | awk '/=> \// {print $3}'); do
    cp -f ${i} /opt/lib &> /dev/null
    chmod +x /opt/lib/${i}
  done
}

#------------------------------------------------------------------------------
# Copy shared libs:
#------------------------------------------------------------------------------

for j in 1 2; do
  for i in $(find /opt); do
    args=$(file --mime $i | egrep "x-executable|x-sharedlib" | cut -f1 -d:)
    [ "$args" != "" ] && isolate $args
  done
done

#------------------------------------------------------------------------------
# Cleanup:
#------------------------------------------------------------------------------

rm -f /opt/lib/libc.so.6
