#!/bin/bash

#------------------------------------------------------------------------------
# Initialization:
#------------------------------------------------------------------------------

DST='/opt/mesos'; [ -d ${DST}/bin ] || mkdir -p ${DST}/bin

#------------------------------------------------------------------------------
# Function: isolate <binary> <type>
#------------------------------------------------------------------------------

function isolate {

  for i in $(ldd $1 |  awk '/=> \// {print $3}'); do
    d="${i%/*}"; [ ! -d ${DST}${d} ] && mkdir -p ${DST}${d}
    cp -f ${i} ${DST}${d}
  done

  case ${2} in
    *-sharedlib)  cp ${1} ${DST}/lib ;;
    *-executable) cp ${1} ${DST}/bin ;;
  esac
}

#------------------------------------------------------------------------------
# Copy executables and shared libs:
#------------------------------------------------------------------------------

for i in $(rpm -ql mesos); do
  args=$(file --mime $i | egrep "x-executable|x-sharedlib" | awk -F"[:;]" '{print $1" "$2}')
  [ "$args" != "" ] && isolate $args
done

#------------------------------------------------------------------------------
# Copy the Web-UI:
#------------------------------------------------------------------------------

cp -R /usr/share/mesos/webui ${DST}
